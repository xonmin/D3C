# 13. 실무에서의 도메인 주도 설계 

DDD의 혜택을 가장 많이 받을 수 있는 프로젝트 : 브라운필드 프로젝트 
- 비즈니스 가능성 입증
- 축적된 기술 부채
- 설계 엔트로피에 맞서 대대적인 변화가 필요한 프로젝트 

## 전략적 분석

### 비즈니스 도메인 이해하기 
- 비즈니스 도메인 파악
- 도메인 확대하여 조직이 상위 목표인 하위 도메인을 달성하기 위해 사용하는 비즈니스 구성요소 찾기 
- 부서와 기타 조직 단위 활용하기 

### 핵심 하위 도메인 
- 핵심 하위 도메인을 식별하는 또 하나의 강력한 휴리스틱 : 커다란 진흙 덩어리 찾기 

### 일반 하위 도메인 
- 상용 솔루션, 구독, 연동할 수 있는 오픈소스 소프트웨어 찾기 

### 지원 하위 도메인 
- 직접 경쟁 우위를 제공하지 않는 나머지 소프트웨어 컴포넌트 찾기 

### 현재 설계 탐색 
비즈니스 도메인을 하위 시스템으로 분해하는 데 사용하는 경계를 살펴보자 
- 수명주기를 분리할 수 있는 지 검토 

### 전략적 설계 평가 
- 각 상위 수준 컴포넌트에 대해 그것이 어느 비즈니스 하위 도메인을 포함하고 어떤 기술적 설계 의사결정을 내렸는지 확인할 것 

### 전략적 설계 평가 
- 상위 수준 컴포넌트에 대한 지식을 사용하여 이러한 컴포넌트가 바운디드 컨텍스트인 것처럼 현재 설계의 컨텍스트 맵을 차트로 표시할 것 
- 최적이 아닌 전략적 설계 의사결정 예시 
  - 동일한 상위 수준의 컴포넌트에 여러 작업하는 팀
  - 핵심 하위 도메인 중복 구현
  - 하청 회사가 핵심 하위 도메인 구현
  - 등등등
 
 ## 현대화 전략
 기존 시스템 개선에 대한 안전한 접근 방식 : 크게 생각하되 작게 시작할 것 
 - 시스템의 하위 도메인을 나누는 경계를 찾는 것 
 - 비즈니스 하위 도메인 경계를 반영하도록 기술적 구현 패턴이 아닌 바운디드 컨텍스트 모듈로 재구성 
 
 ### 전략적 현대화
 - 논리적 경계를 물리적 경계로 바꿔 바운디드 컨텍스트를 추출하는 과정 
 - 필요한 최소 바운디드 컨텍스트가 있다면 이들 간 관계와 연동 패턴을 조사할 것 
 - 서로 다른 바운디드 컨텍스트에서 작업하는 팀이 어떻게 의사소통 협업하는 지 확인 
   - 사용자-제공자 관계 
   - 충돌 방지 계층
   - 오픈 호스트 서비스
   - 분리형 노선
 
 ### 전술적 현대화
 - 비즈니스 가치와 구현 전략에서 가장 고통스러운 부조화를 찾기 
 
 ### 유비쿼터스 언어 육성 
 - 전제조건 : 비즈니스 도메인 지식과 비즈니스 도메인의 효과적인 모델을 만들 것 
 - 비즈니스 기능에 가장 적합한 비즈니스 로직 구현 패턴 결정 
 - 시스템의 전체 컴포넌트를 스트랭글러 패턴을 통해 점진적 교체 / 기존 솔루션 리펙토링 

### 스트랭글러 패턴 
- 새로운 바운디드 컨텍스트인 스트랭글러를 생성 
- 해당 스트랭글러를 통해 레거시의 기능을 해당 컨텍스트로 마이그레이션 
- 보통 퍼사드 패턴과 함께 사용하여 이후에 퍼사드 제거 
- 각 바운디드 컨텍스트는 별도의 하위 시스템이므로, 서로 다른 바운디드 컨텍스트와 DB를 공유할 수 없다는 원칙 완화 가능 

### 전술적 설계 의사결정 리팩터링
- 작은 점진적 조치가 대규모 재작성보다 안전하다 
  - 따라서 tx 스크립트 또는 액티브 레코드 패턴을 바로 이벤트 소싱 도메인 모델로 리팩토링하지 말것 
  - 효과적인 애그리게이트 경계를 찾는 데 노력 투자 하기 
- 도메인 모델로의 리팩터링이 한 번에 이루어질 수 없음 대신 도메인 모델 패턴의 요소들을 점진적 도입 
  - VO 찾기 
  - 비즈니스 로직 수집 조사 후 트랜잭션 경계 분석 (일관성)

### 전술적 설계 의사결정에 대한 확산 방법
논리로 호소할 것
- 명시적 트랜잭션 경계가 중요한 이유 : 데이터 일관성 보호 
- DB 트랜잭션이 애그리게이트 둘 이상의 인스턴스 수정 불가 이유 : 일관성 경계 확인
- 외부 컴포넌트에서 애그리게이트 상태 직접 수정 불가 이유 : 비즈니스 로직을 함께 배치 및 중복되지 않게 
- 애그리게이트 기능 중 일부를 저장 프로시저로 넘길 수 없는 이유 : 로직 중복 방지 및 sync 를 위해
- 넓은 트랜잭션 범위는 애그리게이트의 복잡성을 증가 / 성능 하락 : 따라서 작은 애그리게이트 경계 유지 
- 이벤트 소싱 대신 이벤트를 로그 파일에 기록 할 수 없는 이유 : 장기적으로 데이터 일관성 깨질 염려 
