# 04. 바운디드 컨텍스트 연동 

- 바운디드 컨텍스트 패턴 : 일관성 유지 / 모델링 가능하게 함 
- 다른 바운디드 컨텍스트가 동일한 비즈니스 엔티티 대표 가능 
  - 각 두 바운디드 컨텍스트는 다른 문제를 해결하는 비즈니스 도메인을 모델링 
- 다른 바운디드 컨텍스트는 서로 독립적 발전 및 구현 가능 
- **바운디드 컨텍스트 자체는 독립적이지 않음 (바운디드 컨텍스트간의 상호작용)**
- **컨트랙트** : 바운디드 컨텍스트 간의 접점 

### 바운디드 컨텍스트의 관계(연동)에 따른 패턴 
- 협력
- 사용자-제공자
- 분리형 노선


## 협력형 패턴 그룹 
- 협력 및 소통이 잘 되는 팀에서 사용
- 적합한 요건 : 팀의 커뮤니케이션 & 협업 
- 종류 : 
  -  파트너십 패턴
  -  공유 커널 패턴 
  
### 파트너십 패턴 
![image](https://user-images.githubusercontent.com/27190617/223413493-273eca8c-465f-48fb-900b-7626ebbc56f3.png)

- 바운디드 컨텍스트 간 **애드혹(ad-hoc) - ** 방식으로 조정 
> ad-hoc : 특별한 목적을 위해서

- 연동의 조정 : 양방향 
- 잘 구축된 협업 실무, 높은 수준의 헌신, 잦은 동기화 필수 
- 지리적으로 가까운 팀일수록 유리 

### 공유 커널 패턴 
![image](https://user-images.githubusercontent.com/27190617/223413526-e688e8ce-7609-40e0-bbda-8d7ee5ad4608.png)

- 하위 도메인의 동일 모델 혹은 그 일부가 여러 다른 바운디드 컨텍스트에서 구현되는 경우 
- 공유 커널 :두 바운디드 컨텍스트가 공통으로 사용하는 권한 모델 
- 공유 모델은 두 바운디드 컨텍스트의 일관성이 유지되어야 한다. 
- 각 바운디드 컨텍스트는 권한 모델을 수정할 수 있고, 해당 변경은 모든 바운디드 컨텍스트에 영향을 준다. 
- 파트너십 패턴에 비해 협력적이지 X 
- 바운디드 컨텍스트의 경계 소유권을 위반한 패턴 

**공유 범위**
- 공유 모델의 변경은 다른 모든 바운디드 컨텍스트에 즉시 영향 
- 주의점 : 연쇄 영향 최소화를 위해 공통으로 구현돼야 하는 모델의 일부분만 노출하도록 해야함 

**구현**
- 공유 커널 - 모든 바운디드 컨텍스트에 즉시 반영되도록 구현 
- 영향을 받는 모든 바운디드 컨텍스트에 연동 테스트 수행 

**사용해야 하는 경우**
- 중복 비용 > 조율 비용 
  - 공유하는 코드베이스에 대한 변경을 조율하는 노력보다 공유하는 모델에 대한 변경을 통합할 때 드는 노력이 클 때 

> 통합 비용과 중복 비용의 차이 
> - 모델의 변동성에 따라 달라짐 
> - 변경이 잦을수록 통합 비용 증가 
- 적절한 조율 없이 밀접하게 연결된 기능을 구현해야 할 때 (조직의 정치적 문제 & 지리적 문제) 
- 레거시 시스템 개선 시 
- 동일 팀에서 소유하고 구현한 바운디드 컨텍스트 연동 시 : 자연스레 파트너십 패턴으로 가기도 함


## 사용자 - 제공자 패턴 그룹(customer - supplier) 
![image](https://user-images.githubusercontent.com/27190617/223413570-75796ea2-db0b-4783-9a31-ddba7b4e5461.png)

- 서비스 제공자 : upstream / 사용자 : downstream 
- 협력 그룹과의 차이 : 
  - 양 팀은 서로 독립적 성공 가능 
  - 연동 컨트랙트를 주도하는 권력의 불균형 존재 
- 권력의 불균형에 따라 패턴이 나뉨
  - 순응주의자 
  - 충돌방지 계층
  - 오픈 호스트 서비스 패턴 

### 순응주의자 패턴 
![image](https://user-images.githubusercontent.com/27190617/223414077-eb84efe0-8415-4aa3-b0fa-030af86db960.png)

- 힘의 균형이 : 제공자에게 있는 경우(upstream) 
- 다운 스트림을 신경써도 되지 않는 경우(잘 구축된 모델 / 산업 표준 / 다운스트림의 요건 충분)

### 충돌 방지 계층 패턴 
![image](https://user-images.githubusercontent.com/27190617/223414268-183c7f0a-ec77-4829-b455-73a0cc73e035.png)

- 다운스트림에서 충돌 방지 계층을 통해 업스트림의 바운디드 컨텍스트 모델을 스스로 필요에 맞고 가공
- ex) 
  - 다운스트림 바운디드 컨텍스트가 **핵심 하위 도메인을 포함할 경우**
  - 업스트림 모델이 사용자의 요건에 비효율적이거나 불편한 경우 
  - 제공자가 컨트랙트를 자주 변경할 경우 (보호하기 위해)

### 오픈 호스트 서비스 패턴 (OHS)
![image](https://user-images.githubusercontent.com/27190617/223414749-6fb5366e-28d1-4ceb-92fb-8557e3afce22.png)

- 힘이 사용자 측에 있을 경우 
- 제공자는 구현 모델 분리에 대해 사용자 보호를 위해, 퍼블릭 인터페이스와 구현 모델을 분리 
- 퍼블릭 인터페이스 : 유비쿼터스 언어를 따름 & 연동지향 언어를 통해 편리한 프로토콜을 노출 
  - 이러한 퍼블릭 프로토콜 = 공표된 언어(published Language)
- 충돌 방지 계층 패턴의 반대 
- ![image](https://user-images.githubusercontent.com/27190617/223415265-4f743965-c217-459d-b507-dc9510b60b82.png)

## 분리형 노선 

### 오픈 호스트 서비스 패턴 (OHS)
- 협업 의지가 없거나, 협업할 수 없는 경우
- 커뮤니케이션 이슈 / 일반 하위 도메인 / 모델의 차이 

> 핵심 하위 도메인을 연동할 경우, 협업 없는 분리형 노선은 피해야 함 
> 하위 도메인의 중복 구현은 전략을 효과적이고 효율적으로 구현하는 것을 어렵게 함 

## 컨텍스트 맵
- 바운디드 컨텍스트 간의 연동을 시각적 표현 
![image](https://user-images.githubusercontent.com/27190617/223415675-0a0a77b8-fbce-47ed-9d23-3c786d01fac0.png)

- 컨텍스트 맵 표시의 이점
  - 거시적 설계 관점 제공
  - 커뮤니케이션 패턴 묘사
  - 조직적 문제 통찰력 제공 

### 연습 문제 
- 다운스트림 하위 도메인 중 충돌 방지 계층을 구현할 가능성이 가장 높은 것 : 핵심 하위 도메인
- 업스트립 하위 도메인 중 오픈 호스트 서비스를 구현할 가능성이 가장 높은 것 : 핵심 하위 도메인 
